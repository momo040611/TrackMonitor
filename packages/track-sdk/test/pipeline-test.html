<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SDK å…¨é“¾è·¯é›†æˆæµ‹è¯•</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .card { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
        .btn { padding: 8px 16px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        .btn:hover { background: #0056b3; }
        .btn-err { background: #dc3545; }
        .btn-err:hover { background: #c82333; }
        #console-log { background: #f4f4f4; padding: 10px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>ğŸ¯ SDK å…¨é“¾è·¯é›†æˆæµ‹è¯•</h1>
    
    <div class="card">
        <h3>1. è¡Œä¸ºé‡‡é›† (Behavior & Pipeline)</h3>
        <p>ç­–ç•¥ï¼šè®¾ç½®äº† <code>batchLimit: 3</code>ã€‚ç‚¹å‡» 3 æ¬¡æ‰ä¼šå‘ä¸€æ¡è¯·æ±‚ã€‚</p>
        <button class="btn" id="btn-buy" data-track-name="buy_button">æ¨¡æ‹Ÿè´­ä¹° (ç‚¹å‡»æˆ‘)</button>
        <button class="btn" id="btn-nav">æ™®é€šæŒ‰é’®</button>
    </div>

    <div class="card">
        <h3>2. é”™è¯¯ç›‘æ§ (Error & Realtime)</h3>
        <p>ç­–ç•¥ï¼šé”™è¯¯äº‹ä»¶èµ° VIP é€šé“ï¼Œä¸æ’é˜Ÿï¼Œ<b>ç«‹å³å‘é€</b>ã€‚</p>
        <button class="btn btn-err" id="btn-js-error">è§¦å‘ JS é”™è¯¯</button>
        <button class="btn btn-err" id="btn-promise-error">è§¦å‘ Promise é”™è¯¯</button>
    </div>

    <div class="card">
        <h3>3. å®æ—¶æ—¥å¿—</h3>
        <div id="console-log"></div>
    </div>

    <script type="module">
        // ç›´æ¥å¼•å…¥ä½ çš„æºç 
        import { createTracker } from '../src/core/index.ts';
        import { SenderPlugin } from '../src/plugins/sender/index.ts';
        import { createBehaviorPlugin } from '../src/plugins/behavior/index.ts';
        import { createErrorPlugin } from '../src/plugins/error/index.ts';
        import { createPerformancePlugin } from '../src/plugins/performance/index.ts';

        // åŠ«æŒ console.log æ˜¾ç¤ºåˆ°é¡µé¢ä¸Š
        const originalLog = console.log;
        const logDiv = document.getElementById('console-log');
        console.log = (...args) => {
            originalLog(...args);
            const line = document.createElement('div');
            line.innerText = `[${new Date().toLocaleTimeString()}] ${args.join(' ')}`;
            logDiv.prepend(line);
        };

        console.log('ğŸš€ æ­£åœ¨åˆå§‹åŒ– SDK...');

        // 1. åˆ›å»º Tracker
        const tracker = createTracker({
            context: { appName: 'test-suite', env: 'local' }
        });

        // 2. è£…è½½æ’ä»¶ (æ³¨æ„è¿™é‡Œçš„é¡ºåºå’Œä¼ å‚)
        
        // Sender: è´Ÿè´£å‘è´§
        tracker.use(new SenderPlugin({
            url: 'http://localhost:3000/processing/event',
            batchLimit: 3,  // æ”’å¤Ÿ3æ¡å‘ä¸€æ¬¡
            timeLimit: 5000 // æˆ–ç­‰5ç§’å‘ä¸€æ¬¡
        }));

        // Behavior: è´Ÿè´£ç›‘å¬ç‚¹å‡»
        // ä¼ å…¥ tracker å®ä¾‹ï¼Œå¼€å¯è‡ªåŠ¨é‡‡é›†
        tracker.use(createBehaviorPlugin({ tracker }));

        // Error: è´Ÿè´£ç›‘å¬æŠ¥é”™
        tracker.use(createErrorPlugin({ tracker }));

        // Performance: è´Ÿè´£ç›‘å¬æ€§èƒ½
        tracker.use(createPerformancePlugin({ tracker }));

        console.log(' SDK åˆå§‹åŒ–å®Œæˆï¼');

        // --- ç»‘å®šæµ‹è¯•äº‹ä»¶ ---

        // æ¨¡æ‹Ÿ JS æŠ¥é”™
        document.getElementById('btn-js-error').onclick = () => {
            console.log('è§¦å‘ä¸€ä¸ª JS é”™è¯¯...');
            throw new Error('è¿™æ˜¯ä¸€æ¡æµ‹è¯•ç”¨çš„ JS é”™è¯¯ï¼');
        };

        // æ¨¡æ‹Ÿ Promise æŠ¥é”™
        document.getElementById('btn-promise-error').onclick = () => {
            console.log(' è§¦å‘ä¸€ä¸ª Promise æ‹’ç»...');
            Promise.reject('è¿™æ˜¯ä¸€æ¡æµ‹è¯•ç”¨çš„ Promise Errorï¼');
        };

    </script>
</body>
</html>