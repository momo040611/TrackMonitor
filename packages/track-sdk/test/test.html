<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDK Pipeline æµ‹è¯•é¶åœº</title>
</head>
<body>
    <h1>åŸ‹ç‚¹ SDK å‘é€æµ‹è¯•</h1>
    
    <div style="border: 1px solid #ccc; padding: 20px; margin-bottom: 20px;">
        <h3>1. æ¨¡æ‹Ÿæ™®é€šè¡Œä¸º (æµ‹è¯•æ‰¹é‡å‘é€)</h3>
        <p>ç­–ç•¥ï¼šè®¾ç½®äº† batchLimit: 3ã€‚ç‚¹å‡» 3 æ¬¡æ‰ä¼šå‘ä¸€æ¡è¯·æ±‚ã€‚</p>
        <button id="btn-pv">æ¨¡æ‹Ÿ PageView</button>
        <button id="btn-click">æ¨¡æ‹Ÿ Click (ç‚¹æˆ‘)</button>
    </div>

    <div style="border: 1px solid red; padding: 20px;">
        <h3>2. æ¨¡æ‹ŸæŠ¥é”™ (æµ‹è¯•ç«‹å³å‘é€)</h3>
        <p>ç­–ç•¥ï¼šError äº‹ä»¶ä¸æ’é˜Ÿï¼Œç‚¹ä¸€ä¸‹å‘ä¸€ä¸‹ã€‚</p>
        <button id="btn-error">æ¨¡æ‹Ÿ JS æŠ¥é”™</button>
    </div>

    <script type="module">
        // å‡è®¾ä½ ä½¿ç”¨ Vite å¯åŠ¨ï¼Œå¯ä»¥ç›´æ¥ import TS æ–‡ä»¶
        // å¦‚æœæŠ¥é”™æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œè¯·æ”¹ä¸ºå¼•å…¥æ‰“åŒ…åçš„æ–‡ä»¶ (å¦‚ ../dist/index.mjs)
        import { createTracker } from '../src/core/index.ts'; 
        import { SenderPlugin } from '../src/plugins/sender/index.ts';

        // 1. åˆå§‹åŒ– SDK
        const tracker = createTracker({
            context: {
                appName: 'test-app',
                env: 'dev'
            }
        });

        // 2. è£…è½½å‘é€æ’ä»¶ (é…ç½®è¿æ¥ä½ çš„åç«¯)
        tracker.use(new SenderPlugin({
            url: 'http://localhost:3000/processing/event', // ç¡®ä¿ä½ çš„ NestJS åç«¯å¼€åœ¨ 3000
            batchLimit: 3,  // æ”’å¤Ÿ 3 æ¡å‘ä¸€æ¬¡
            timeLimit: 5000 // æˆ–è€…ç­‰ 5 ç§’å‘ä¸€æ¬¡
        }));

        console.log('âœ… SDK åˆå§‹åŒ–å®Œæˆ');

        // 3. ç»‘å®šæµ‹è¯•æŒ‰é’®
        let count = 0;
        document.getElementById('btn-click').onclick = () => {
            count++;
            console.log(`[ç‚¹å‡»] ç§¯å‹ç¬¬ ${count} æ¡æ•°æ®...`);
            tracker.track('button_click', { 
                btn_name: 'test_btn', 
                count: count 
            });
        };

        document.getElementById('btn-pv').onclick = () => {
            count++;
            console.log(`[PV] ç§¯å‹ç¬¬ ${count} æ¡æ•°æ®...`);
            tracker.track('page_view', { path: '/test.html' });
        };

        document.getElementById('btn-error').onclick = () => {
            console.log('ğŸš¨ [æŠ¥é”™] åº”è¯¥ç«‹å³å‘é€ï¼');
            // æ³¨æ„ï¼šäº‹ä»¶åä»¥ error_ å¼€å¤´ï¼Œè§¦å‘æˆ‘ä»¬å†™çš„é«˜ä¼˜å…ˆçº§é€»è¾‘
            tracker.track('error_js', { 
                message: 'Test Error: variable is undefined',
                stack: 'at test.html:50:10'
            });
        };
    </script>
</body>
</html>